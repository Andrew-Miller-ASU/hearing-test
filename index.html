<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Hearing Test</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div id="container">
    <h1>Online Hearing Test</h1>
    <div id="mode-select">
       <h2>Choose Your Test Mode</h2>
       <button onclick="startTest('both')">ðŸ”Š No Headphones</button>
       <button onclick="startTest('headphones')">ðŸŽ§ Headphones (Left & Right)</button>
       <button onclick="startDbHlTest()">dB HL Testing</button>
    </div>
    <div id="test-area" style="display: none;">
      <p><em>Click "Play", then tell us if you can hear the sound. This helps check your hearing sensitivity at different tones.</em></p>
      <p id="question">Press play to start the test</p>
      <audio id="tone" controls></audio><br>
      <button onclick="recordResponse(true)">Yes</button>
      <button onclick="recordResponse(false)">No</button>
    </div>

    <div id="dbhl-test-area" style="display:none;">
      <p style="margin-bottom:12px; text-align: left;">Decibels Hearing Level, or dB HL, is a measure of the quietest sound you can hear relative to a person with normal hearing. If your dB HL is negative, then you hear better than average; if it's positive, then you hear worse than average. -10 to 15 dB is considered a normal range.</p>
      <p style="margin-bottom:12px; text-align: left;">This test will measure your dB HL by playing a 1 kHz tone for 1 second and seeing how you respond. If you can't hear the sound, then click "No", and it will become slightly louder. Once you're able to hear the tone, click "Yes" to end the test and receive your results.</p>
      <br>
      <div id="dbhl-controls" style="display:grid; grid-template-columns:max-content 110px 380px; grid-template-rows:auto auto; column-gap:48px; row-gap:8px; align-items:baseline; margin:8px 0;">
        <label for="dbhl-start" style="justify-self:start;">Start level (dBFS):</label>
        <input id="dbhl-start" type="number" value="-90" step="1" min="-120" max="-1" style="width:100px">
        <span id="dbhl-status" style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-style:italic; padding-left:24px; align-self:baseline;"></span>
        <label for="dbhl-step" style="justify-self:start;">Step size (dB):</label>
        <input id="dbhl-step" type="number" value="2.0" step="0.5" min="0.1" max="20" style="width:100px">
        <div id="dbhl-replay-row" style="display:none; padding-left:24px;">
          <button id="dbhl-replay-btn" type="button" style="padding:8px 12px; border:none; border-radius:8px; font-weight:600; cursor:pointer;">Replay</button>
        </div>
      </div>
      <br>
      <div id="dbhl-start-row" style="display:flex; justify-content:center; margin:12px 0;">
        <button id="dbhl-start-btn" type="button" style="padding:8px 12px; border:none; border-radius:8px; font-weight:600; cursor:pointer;">Start Test</button>
      </div>
      <div id="dbhl-response-row" style="display:none; gap:12px; margin:12px 0;">
        <button id="dbhl-yes" style="background:#16a34a; color:#fff; padding:8px 12px; border:none; border-radius:8px; font-weight:600; cursor:pointer;">Yes, I heard it</button>
        <button id="dbhl-no" style="background:#dc2626; color:#fff; padding:8px 12px; border:none; border-radius:8px; font-weight:600; cursor:pointer;">No, I didn't hear it</button>
      </div>
      <p id="dbhl-result" style="font-weight:600; margin-top:10px;"></p>
      <pre id="dbhl-log" style="background:#f8f9fa; padding:10px; border-radius:8px; max-height:200px; overflow:auto; margin-top:8px;"></pre>
    </div>

    <!-- Results will appear here -->
    <!-- Always-visible summary -->
    <section id="summary-section" style="display: none; margin-top: 2rem;">
    <h2>Hearing Test Summary</h2>
    <p id="summary-text" style="font-size: 1.1rem; padding: 1rem;"></p>
    </section>

    <!-- Expandable detailed section -->
    <details id="results-detail" style="display: none;">
    <summary><h3>See Detailed Results (Table & Audiogram)</h3></summary>

    <div style="margin-top: 1rem;">
        <table id="results-table">
        <tr><th>Frequency (Hz)</th><th>Volume (dB)</th><th>Result</th></tr>
        </table>

        <h3>Audiogram</h3>
        <canvas id="audiogramChart" width="600" height="400"></canvas>
    </div>
    </details>
  </div>

  <script src="script.js"></script>
</body>
</html>
